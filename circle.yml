machine:
  python:
    version: 3.4.3
  services:
    - rabbitmq-server
  environment:
    IMAGE_TAG: ${CIRCLE_SHA1}
  pre:
    - sudo apt-get install -y erlang-nox init-system-helpers socat adduser logrotate
    - sudo curl -o rabbitmq-server_3.6.5-1_all.deb https://www.rabbitmq.com/releases/rabbitmq-server/v3.6.5/rabbitmq-server_3.6.5-1_all.deb
    - sudo dpkg -i rabbitmq-server_3.6.5-1_all.deb
    - sudo curl -o /usr/lib/rabbitmq/lib/rabbitmq_server-3.6.5/rabbitmq_delayed_message_exchange-0.0.1.ez http://www.rabbitmq.com/community-plugins/v3.6.x/rabbitmq_delayed_message_exchange-0.0.1.ez
    - sudo rabbitmq-plugins enable rabbitmq_management
    - sudo rabbitmq-plugins enable rabbitmq_delayed_message_exchange
    - sudo /etc/init.d/rabbit-server restart

dependencies:
  pre:
    - pip install -U pip setuptools tox
    - pip install -e ".[dev]"
    - pyenv local 2.7.10 3.3.6 3.4.3

test:
    override:
      - tox
